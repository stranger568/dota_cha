_G.Skills_table =
{
	[1] = 
	{
		{"modifier_skill_based", "skill_based", "tier1/Based"},
		{"modifier_skill_damage_dealer", "skill_damage_dealer", "tier1/Damage_Dealer"},
		{"modifier_skill_ultimate_strength", "skill_ultimate_strength", "tier1/Ultimate_Strength"},
		{"modifier_skill_amplification", "skill_amplification", "tier1/Amplification"},
		{"modifier_skill_armorless", "skill_armorless", "tier1/Armorless"},
		{"modifier_skill_lifestealer", "skill_lifestealer", "tier1/Lifestealer"},
		{"modifier_skill_spell_lifestealer", "skill_spell_lifestealer", "tier1/Spell_Lifestealer"},
		{"modifier_skill_ceremonius", "skill_ceremonius", "tier1/Ceremonius"},
		{"modifier_skill_speedster", "skill_speedster", "tier1/Speedster"},
		{"modifier_skill_dodger", "skill_dodger", "tier1/Dodger"},
		{"modifier_skill_armored", "skill_armored", "tier1/Armored"},
		{"modifier_skill_splash", "skill_splash", "tier1/Splash"},
		{"modifier_skill_masters_gift", "skill_masters_gift", "tier1/masters_gift"},
		{"modifier_skill_magic_resist", "skill_magic_resist", "tier1/magic_resist"},
        {"modifier_skill_recovery", "skill_recovery", "tier1/skill_recovery"},
        {"modifier_skill_dracarys", "skill_dracarys", "tier1/skill_dracarys"},
        {"modifier_skill_acceleration", "skill_acceleration", "tier1/skill_acceleration"},
        {"modifier_skill_protection", "skill_protection", "tier1/skill_protection"},
        {"modifier_skill_corrosive", "skill_corrosive", "tier1/skill_corrosive"},
	},
	[2] = 
	{
		{"modifier_skill_golden_warrior", "skill_golden_warrior", "tier2/Golden_Warrior"},
		{"modifier_skill_solo", "skill_solo", "tier2/Solo32"},
		{"modifier_skill_veteran", "skill_veteran", "tier2/Veteran"},
		{"modifier_skill_benefiter", "skill_benefiter", "tier2/Benefiter"},
		{"modifier_skill_gambler", "skill_gambler", "tier2/Gambler"},
		{"modifier_skill_smoker", "skill_smoker", "tier2/Smoker"},
		{"modifier_skill_head_hunter", "skill_head_hunter", "tier2/Head_Hunter"},
		{"modifier_skill_good_job", "skill_good_job", "tier2/Good_Job"},
		--{"modifier_skill_goldgainer", "skill_goldgainer", "tier2/Goldgainer"},
		{"modifier_skill_goldstealer", "skill_goldstealer", "tier2/Goldgainer_small"},
		{"modifier_skill_deposit", "skill_deposit", "tier2/Deposit"},
		{"modifier_skill_investment", "skill_investment", "tier2/Investment"},
		{"modifier_skill_warrior_investor", "skill_warrior_investor", "tier2/Damage_Investor"},
		{"modifier_skill_magic_investor", "skill_magic_investor", "tier2/Magic_Investor"},
		{"modifier_skill_retraining", "skill_retraining", "tier2/retraining"},
		{"modifier_skill_outsiders", "skill_outsiders", "tier2/outsiders"},
        {"modifier_skill_pilferer", "skill_pilferer", "tier2/skill_pilferer"},
        {"modifier_skill_rake", "skill_rake", "tier2/skill_rake"},
	},
	[3] = 
	{
		{"modifier_skill_teachers_gift", "skill_teachers_gift", "tier3/Teachers_Gift"},
		{"modifier_skill_magefense", "skill_magefense", "tier3/Magefense"},
		{"modifier_skill_trickster", "skill_trickster", "tier3/Trickster"},
		{"modifier_skill_disregarding", "skill_disregarding", "tier3/Disregarding"},
		{"modifier_skill_velocity", "skill_velocity", "tier3/Velocity"},
		{"modifier_skill_two_hearted", "skill_two_hearted", "tier3/Two_Hearted"},
		{"modifier_skill_requite", "skill_requite", "tier3/Requite"},
		{"modifier_skill_ranger", "skill_ranger", "tier3/Ranger"},
		{"modifier_skill_deceleration", "skill_deceleration", "tier3/Deceleration"},
		{"modifier_skill_basher", "skill_basher", "tier3/Basher"},
		{"modifier_skill_mage_slayer", "skill_mage_slayer", "tier3/Mage_Slayer"},
		{"modifier_skill_slackening", "skill_slackening", "tier3/Slackening"},
		{"modifier_skill_craggy_man", "skill_craggy_man", "tier3/Craggy_Man"},
		{"modifier_skill_reducer", "skill_reducer", "tier3/Reducer"},
		{"modifier_skill_mana_degrade", "skill_mana_degrade", "tier3/Mana_Degrade"},
		{"modifier_skill_master_chifu", "skill_master_chifu", "tier5/Master_Chifu"},
		{"modifier_skill_true_strike", "skill_true_strike", "tier3/true_strike"},
		{"modifier_skill_kraken_shell", "skill_kraken_shell", "tier3/kraken_shell"},
        {"modifier_skill_disarmer", "skill_disarmer", "tier3/skill_disarmer"},
        {"modifier_skill_breaker", "skill_breaker", "tier3/skill_breaker"},
        {"modifier_skill_magic_shroud", "skill_magic_shroud", "tier3/skill_magic_shroud"},
        {"modifier_skill_intimidation", "skill_intimidation", "tier3/skill_intimidation"},
	},
	[4] = 
	{
		{"modifier_skill_zoo_enjoyer", "skill_zoo_enjoyer", "tier4/Zoo_Enjoyer"},
		{"modifier_skill_hookah_master", "skill_hookah_master", "tier4/Hookah_Master"},
		{"modifier_skill_killgolder", "skill_killgolder", "tier4/Killgolder"},
		{"modifier_skill_rebirth", "skill_rebirth", "tier4/Rebirth"},
		{"modifier_skill_highroller", "skill_highroller", "tier4/Highroller"},
		{"modifier_skill_merchant", "skill_merchant", "tier4/Merchant"},
		{"modifier_skill_hellcrown", "skill_hellcrown", "tier4/Hellcrown"},
		{"modifier_skill_bloodmage", "skill_bloodmage", "tier4/Bloodmage"},
		{"modifier_skill_swiftness", "skill_swiftness", "tier4/Swiftness"},
		{"modifier_skill_resister", "skill_resister", "tier4/Resister"},
		{"modifier_skill_statist", "skill_statist", "tier4/Statist"},
		{"modifier_skill_overbuffed", "skill_overbuffed", "tier4/Overbuffed"},
		{"modifier_skill_eternalist", "skill_eternalist", "tier4/Eternalist"},
        {"modifier_skill_wisdom", "skill_wisdom", "tier4/skill_wisdom"},
        {"modifier_skill_wide_choice", "skill_wide_choice", "tier4/skill_wide_choice"},
        {"modifier_skill_all_inclusive", "skill_all_inclusive", "tier4/skill_all_inclusive"},
        {"modifier_skill_creephater", "skill_creephater", "tier4/skill_creephater"},
        {"modifier_skill_experience_is_gold", "skill_experience_is_gold", "tier4/skill_experience_is_gold"},
        {"modifier_skill_rune_forge", "skill_rune_forge", "tier4/skill_rune_forge"},
	},
	[5] = 
	{
		{"modifier_skill_linkens_sphere", "skill_linkens_sphere", "tier5/Linkens_Sphere"},
		{"modifier_skill_forrest_gump", "skill_forrest_gump", "tier5/Forrest_Gump"},
		{"modifier_skill_timeless_souvenir", "skill_timeless_souvenir", "tier5/Timeless_Souvenir"},
		{"modifier_skill_overcharge", "skill_overcharge", "tier5/Overcharge"},
		{"modifier_skill_double_trouble", "skill_double_trouble", "tier5/Double_Trouble"},
		{"modifier_skill_cashback", "skill_cashback", "tier5/Cashback"},
		{"modifier_skill_second_life", "skill_second_life", "tier5/Second_Life"},
		{"modifier_skill_zoo_director", "skill_zoo_director", "tier5/Zoo_Director"},
		{"modifier_skill_multicast", "skill_multicast", "tier5/Multicast"},
		{"modifier_skill_radioactive", "skill_radioactive", "tier5/Radioactive"},
		{"modifier_skill_pierce", "skill_pierce", "tier5/Pierce"},
		{"modifier_skill_enervation", "skill_enervation", "tier5/Enervation"},
		{"modifier_skill_unbreakble", "skill_unbreakble", "tier5/Unbreakble"},
		{"modifier_skill_slighting", "skill_slighting", "tier5/Slighting"},
		{"modifier_skill_overclocking", "skill_overclocking", "tier5/Overclocking"},
		{"modifier_skill_fearful", "skill_fearful", "tier5/Fearful"},
		{"modifier_skill_last_chance", "skill_last_chance", "tier5/Last_Chance"},
		{"modifier_skill_berserker", "skill_berserker", "tier5/Berserker"},
		{"modifier_skill_soul_cleanse", "skill_soul_cleanse", "tier5/soul_cleanse"},
		{"modifier_skill_rearm", "skill_rearm", "tier5/rearm"},
		{"modifier_skill_fervor", "skill_fervor", "tier5/fervor"},
		{"modifier_skill_block_shield", "skill_block_shield", "tier5/block_shield"},
        {"modifier_skill_duelist", "skill_duelist", "tier5/skill_duelist"},
        {"modifier_skill_purger", "skill_purger", "tier5/skill_purger"},
        {"modifier_skill_normal_juju", "skill_normal_juju", "tier5/skill_normal_juju"},
        {"modifier_skill_giants_aura", "skill_giants_aura", "tier5/skill_giants_aura"},
        --{"modifier_skill_mirror_shield", "skill_mirror_shield", "tier5/skill_mirror_shield"},
	}
}

CustomNetTables:SetTableValue('skills_table', "tier_1", {skills = Skills_table[1]})
CustomNetTables:SetTableValue('skills_table', "tier_2", {skills = Skills_table[2]})
CustomNetTables:SetTableValue('skills_table', "tier_3", {skills = Skills_table[3]})
CustomNetTables:SetTableValue('skills_table', "tier_4", {skills = Skills_table[4]})
CustomNetTables:SetTableValue('skills_table', "tier_5", {skills = Skills_table[5]})

for tier, tier_talents in pairs(Skills_table) do
	for _, skill_info in pairs(tier_talents) do
		LinkLuaModifier(skill_info[1], "modifiers/skills/"..skill_info[1]..".lua", LUA_MODIFIER_MOTION_NONE)
	end
end

Skills = class({})

function Skills:ChooseSkill(data)
	if data.PlayerID == nil then return end
	if data.skill == nil then return end
	if not GameRules:IsCheatMode() then return end
	local hero = PlayerResource:GetSelectedHeroEntity(data.PlayerID) or GameMode.HeroesPlayersList[data.PlayerID]
	local tier = tonumber(data.tier)
	if GameMode.currentRound and GameMode.currentRound.nRoundNumber > 80 then
		tier = 6
	end
	if hero then
		hero.selected_skill = false
		hero.selected_skills[tonumber(tier)] = true
	end
    local ability_mod = nil
    if data.skill then
        if data.skill == "modifier_skill_berserker" or data.skill == "modifier_skill_breaker" or data.skill == "modifier_skill_duelist" or data.skill == "modifier_skill_fearful" or data.skill == "modifier_skill_fervor" or data.skill == "modifier_skill_overclocking" then
            local empty_0 = hero:FindAbilityByName("empty_0")
            if empty_0 then
                ability_mod = empty_0
            end
        end
    end
	Timers:CreateTimer(0,function()	
		if hero and not hero:IsAlive() then return 0.1 end
		if hero:HasModifier(data.skill) then
			hero:RemoveModifierByName(data.skill)
		else
			local modifier_talent = hero:AddNewModifier(hero, ability_mod, data.skill, {})
		end
	end)
end

function Skills:ChooseSkillReal(data)
	if data.PlayerID == nil then return end
	if data.skill == nil then return end
	local hero = PlayerResource:GetSelectedHeroEntity(data.PlayerID)
	local tier = tonumber(data.tier)
	if GameMode.currentRound and GameMode.currentRound.nRoundNumber > 80 then
		tier = 6
	end
	if hero then
		hero.selected_skill = false
		hero.selected_skills[tonumber(tier)] = true
	end
    local ability_mod = nil
    if data.skill then
        if data.skill == "modifier_skill_berserker" or data.skill == "modifier_skill_basher" or data.skill == "modifier_skill_breaker" or data.skill == "modifier_skill_duelist" or data.skill == "modifier_skill_fearful" or data.skill == "modifier_skill_fervor" or data.skill == "modifier_skill_overclocking" then
            local empty_0 = hero:FindAbilityByName("empty_0")
            if empty_0 then
                ability_mod = empty_0
            end
        end
    end
	Timers:CreateTimer(0,function()	
		if hero and not hero:IsAlive() then return 0.1 end
		local modifier_talent = hero:AddNewModifier(hero, ability_mod, data.skill, {})
	end)
end

function Skills:CreateRandomSkillsForPlayer(nPlayerID, tier, double)
    if GetMapName() == "1x8_old" then return end
    local hHero = PlayerResource:GetSelectedHeroEntity(nPlayerID) or GameMode.HeroesPlayersList[nPlayerID]
    if not hHero then return end
    local hPlayer = PlayerResource:GetPlayer(nPlayerID)
    if not hPlayer then return end
    if hHero.selected_skill == true then return end

    local tier_skills = table.deepcopy(Skills_table[tier])
    local tier_skills_choose = {}

    for _, info in ipairs(tier_skills) do
    	if hHero:HasModifier(info[1]) then
    		table.remove_item(tier_skills, info)
    	end
        if hHero:HasModifier("modifier_skill_last_chance") and info[1] == "modifier_skill_second_life" then
            table.remove_item(tier_skills, info)
        end
        if hHero:HasModifier("modifier_skill_second_life") and info[1] == "modifier_skill_last_chance" then
            table.remove_item(tier_skills, info)
        end
    end

    if tier == 5 then
    	Quests_arena:QuestProgress(nPlayerID, 42, 1)
    	tier_skills_choose = table.random_some(tier_skills, 5)
    else
    	tier_skills_choose = table.random_some(tier_skills, 5)
    end

    hHero.selected_skill = true

    CustomGameEventManager:Send_ServerToPlayer(hPlayer, "ShowSkillChoose", {skills = tier_skills_choose, tier = tier})
end














